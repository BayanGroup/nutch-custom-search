<?xml version="1.0" encoding="UTF-8"?>

<config xmlns="http://bayan.ir" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://bayan.ir extractors.xsd"
	omitNonMatching="true">
	<types>
		<type name="long" converter="ir.co.bayan.simorq.zal.extractor.convert.LongConverter" />
		<type name="float" converter="ir.co.bayan.simorq.zal.extractor.convert.FloatConverter" />
		<type name="date" converter="ir.co.bayan.simorq.zal.extractor.convert.DateConverter" />
		<type name="date-time" converter="ir.co.bayan.simorq.zal.extractor.convert.DateTimeConverter" />
		<type name="persian-date" converter="ir.co.bayan.simorq.zal.extractor.convert.PersianDateConverter"/>
	</types>
	<fields>
		<field name="post-title" />
		<field name="post-blog-title" />
		<field name="post-body" />
		<field name="post-comments" />
		<field name="post-comments-num" type="long" />
		<field name="post-categories" />
		
		<field name="blog-title" />
		<field name="blog-sub-title" />
		<field name="blog-desc" />
		<field name="blog-total-visits" type="long"/>
		
		<field name="keywords" />
		<field name="description" />
		<field name="modification-date" type="date-time"/>
		<field name="author" />
		<field name="document-type" multi="true" />
		<field name="csi" type="long"/>
		<field name="url"/>
		<field name="display-url" />
		<field name="title" />
		<field name="content" />
		<field name="site" multi="true" />
		<field name="boost" type="float" />
	</fields>
	<documents>
		<document id="common" engine="css">
			<extract-to field="display-url">
				<decode>
					<url />
				</decode>
			</extract-to>
			<extract-to field="title">
				<truncate max="100" append=" ...">
					<text>
						<first>
							<expr value="title" />
						</first>
					</text>
				</truncate>
			</extract-to>
			<extract-to field="site">
				<replace pattern="^.+?://(.+?\.)(.+?)/.*" substitution="$2">
					<url/>
				</replace>
			</extract-to>
			<extract-to field="site">
				<replace pattern="^.+?://(.+?)/.*" substitution="$1">
					<url/>
				</replace>
			</extract-to>
		</document>
		<document id="blog-ir" inherits="common">
			<extract-to field="csi">
				<constant value="1479467467723760090"/>
			</extract-to>
			<extract-to field="boost">
				<constant value="1.0"/>
			</extract-to>
		</document>
		<document id="blog-ir-page" inherits="blog-ir" engine="css">
			<extract-to field="author">
				<trim>
					<text>
						<first>
							<expr value=".author, .author2, .author3"/>
						</first>
					</text>
				</trim>
			</extract-to>
		</document>
		<document id="blog-ir-post-page" inherits="blog-ir-page">
			<extract-to field="post-title">
				<trim>
					<replace pattern="(.+?) :: (.+)" substitution="$2">
						<text>
							<expr value="title"/>
						</text>
					</replace>
				</trim>
			</extract-to>
			<extract-to field="post-blog-title">
				<trim>
					<replace pattern="(.+?) :: (.+)" substitution="$1">
						<text>
							<expr value="title"/>
						</text>
					</replace>
				</trim>
			</extract-to>
			<extract-to field="post-body">
				<text>
					<expr value=".post .body"/>
				</text>
			</extract-to>
		</document>
		<document url="blog.ir/((\d{4}/\d{2})|post)" inherits="blog-ir-post-page" engine="css" update="false">
			<outlinks>
				<link>
					<href>
						<resolve>
							<attribute name="href">
								<expr value=".post a[rel!=nofollow]"/>
							</attribute>
						</resolve>
					</href>
				</link>
			</outlinks>
			<extract-to field="modification-date" >
				<attribute name="content">
					<expr value="meta[name=date]"/>
				</attribute>
			</extract-to>
			<extract-to field="post-comments">
				<concat>
					<text>
						<expr value=".post_comments .body_cmt"/>
					</text>
					<replace pattern="^(پاسخ:)?(.*)" substitution="$2">
						<text>
							<expr value=".cmt_reply"/>
						</text>
					</replace>
				</concat>
			</extract-to>
			<extract-to field="keywords">
				<trim>
					<text>
						<expr value=".keywords_post"/>
					</text>
				</trim>
			</extract-to>
			<extract-to field="content">
				<concat>
					<field-value field="post-body" />
					<field-value field="post-comments" />
				</concat>
			</extract-to>
			<extract-to field="document-type">
				<constant value="post"/>
			</extract-to>
			<extract-to field="document-type">
				<constant value="blog"/>
			</extract-to>
		</document>
		<document url="blog.ir/page" inherits="blog-ir-post-page">
			<extract-to field="content">
				<field-value field="post-body" />
			</extract-to>
			<extract-to field="document-type">
				<constant value="page"/>
			</extract-to>
			<extract-to field="document-type">
				<constant value="blog"/>
			</extract-to>
		</document>
		<document url="blog.ir/sitemap.xml" engine="xpath">
			<outlinks>
				<for-each root="dns:url"> 
					<link>
						<href>
							<text>
								<expr value="./dns:loc" />
							</text>
						</href>
						<anchor>
							<text>
								<expr value="./blog:dloc" />
							</text>
						</anchor>
					</link>
				</for-each>
			</outlinks>
			<extract-to field="document-type">
				<constant value="sitemap"/>
			</extract-to>
			<extract-to field="document-type">
				<constant value="blog"/>
			</extract-to>			
		</document>
		<document url="blog.ir/category" inherits="blog-ir-page" engine="css">
			<extract-to field="content">
				<text>
					<expr value=".post"/>
				</text>
			</extract-to>
			<extract-to field="document-type">
				<constant value="category"/>
			</extract-to>
			<extract-to field="document-type">
				<constant value="blog"/>
			</extract-to>
		</document>
		<document url="blog.ir/tag" inherits="blog-ir-page" engine="css">
			<extract-to field="content">
				<text>
					<expr value=".post"/>
				</text>
			</extract-to>
			<extract-to field="document-type">
				<constant value="tag"/>
			</extract-to>
			<extract-to field="document-type">
				<constant value="blog"/>
			</extract-to>
		</document>
		<document url="blog.ir/?$" inherits="blog-ir-page">
			<outlinks>
				<!-- 
				<link>
					<href>
						<concat delimiter="">
							<url />
							<constant value="rss/" />
						</concat>
					</href>
				</link> -->
				<link>
					<href>
						<concat delimiter="">
							<url />
							<constant value="sitemap.xml" />
						</concat>
					</href>
				</link>
				<link>
					<href>
						<resolve>
							<attribute name="href">
								<expr value="a[rel!=nofollow]"/>
							</attribute>
						</resolve>
					</href>
				</link>
			</outlinks>
			<extract-to field="blog-title">
				<trim>
					<text>
						<expr value="title"/>
					</text>
				</trim>
			</extract-to>
			<extract-to field="blog-sub-title">
				<text>
					<expr value=".title_desc .desc"/>
				</text>
			</extract-to>
			<extract-to field="blog-desc">
				<text>
					<expr value=".blog_description"/>
				</text>
			</extract-to>
			<extract-to field="content">
				<text>
					<expr value="body"/>
				</text>
			</extract-to>
			<extract-to field="description">
				<concat>
					<field-value field="blog-sub-title" />
					<field-value field="blog-desc" />
				</concat>
			</extract-to>
			<extract-to field="keywords">
				<trim>
					<text>
						<expr value=".tagcloud"/>
					</text>
				</trim>
			</extract-to>
			<extract-to field="document-type">
				<constant value="home"/>
			</extract-to>
			<extract-to field="document-type">
				<constant value="blog"/>
			</extract-to>
			<extract-to field="boost">
				<constant value="2.0"/>
			</extract-to>
		</document>
		<!-- 
		<document url="blog.ir/rss" engine="xpath" root="//item" inherits="blog-ir" update="true">
			<extract-to field="url">
				<text>
					<expr value="./link" />
				</text>
			</extract-to>
			<extract-to field="author">
				<text>
					<expr value="./dc:creator" />
				</text>
			</extract-to>
			<extract-to field="keywords">
				<trim>
					<text>
						<expr value="./category" />
					</text>
				</trim>
			</extract-to>
			<extract-to field="post-comments-num">
				<text>
					<expr value="./slash:comments"/>
				</text>
			</extract-to>
		</document>
		<document url="http://blog.ir/changes" engine="css">
			<outlinks>
				<for-each root=".post">
					<link>
						<href>
							<attribute name="href">
								<expr value="a" />
							</attribute>
						</href>
					</link>
				</for-each>	
			</outlinks>				
		</document>
		 -->
	</documents>
</config>