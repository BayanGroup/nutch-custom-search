<?xml version="1.0" encoding="UTF-8"?>

<config xmlns="http://bayan.ir" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://bayan.ir extractors.xsd"
	omitNonMatching="true">
	<types>
		<type name="long" converter="ir.co.bayan.simorq.zal.extractor.convert.LongConverter" />
		<type name="date" converter="ir.co.bayan.simorq.zal.extractor.convert.DateConverter" />
		<type name="persian-date" converter="ir.co.bayan.simorq.zal.extractor.convert.PersianDateConverter"/>
		<type name="persian-long" converter="ir.co.bayan.simorq.zal.extractor.convert.PersianLongConverter"/>
	</types>
	<fields>
		<field name="post-title" />
		<field name="post-blog-title" />
		<field name="post-body" />
		<field name="post-author" />
		<field name="post-date" type="date"/>
		<field name="post-comments" />
		<field name="post-comments-num" type="long" />
		<field name="post-keywords" />
		<field name="post-categories" />
		
		<field name="blog-title" />
		<field name="blog-sub-title" />
		<field name="blog-desc" />
		<field name="blog-author" />
		<field name="blog-keywords" />
		
		<field name="document-type" />
		<field name="csi" />
		<field name="url"/>
		<field name="title" />
		<field name="content" />
	</fields>
	<documents>
		<document id="blog-ir">
			<extract-to field="csi">
				<constant value="1"/>
			</extract-to>
		</document>
		<document id="blog-ir-post-page" inherits="blog-ir">
			<extract-to field="post-title">
				<trim>
					<replace pattern="(.+?) :: (.+)" substitution="$2">
						<text>
							<expr value="title"/>
						</text>
					</replace>
				</trim>
			</extract-to>
			<extract-to field="post-blog-title">
				<replace pattern="(.+?) :: (.+)" substitution="$1">
					<text>
						<expr value="title"/>
					</text>
				</replace>
			</extract-to>
			<extract-to field="post-body">
				<text>
					<expr value=".post .body .cnt"/>
				</text>
			</extract-to>
		</document>
		<document url="^http://.+?\.blog.ir/((\d{4}/\d{2})|post)/.+" inherits="blog-ir-post-page" engine="css">
			<extract-to field="post-date" >
				<replace pattern="(.+?)T(.+)" substitution="$1">
					<attribute name="content">
						<expr value="meta[name=date]"/>
					</attribute>
				</replace>
			</extract-to>
			<extract-to field="post-comments">
				<concat>
					<text>
						<expr value=".post_comments .body_cmt .cnt span.cnt_l"/>
					</text>
					<replace pattern="^(پاسخ:)?(.*)" substitution="$2">
						<text>
							<expr value=".cmt_reply"/>
						</text>
					</replace>
				</concat>
			</extract-to>
			<extract-to field="post-keywords">
				<text>
					<expr value=".keywords_post h3"/>
				</text>
			</extract-to>
			<extract-to field="document-type">
				<constant value="Post"/>
			</extract-to>
		</document>
		<document url="^http://.+?\.blog.ir/page/.+" inherits="blog-ir-post-page">
			<extract-to field="document-type">
				<constant value="Custom-Page"/>
			</extract-to>
		</document>
		<document url="^http://.+?\.blog.ir/?" inherits="blog-ir">
			<outlinks>
				<link>
					<href>
						<concat delimiter="/">
							<url />
							<constant value="rss/" />
						</concat>
					</href>
				</link>
				<link>
					<href>
						<concat delimiter="/">
							<url />
							<constant value="sitemap.xml" />
						</concat>
					</href>
				</link>
			</outlinks>
			<extract-to field="blog-title">
				<text>
					<expr value="title"/>
				</text>
			</extract-to>
			<extract-to field="blog-sub-title">
				<text>
					<expr value="div.desc h2"/>
				</text>
			</extract-to>
			<extract-to field="blog-desc">
				<text>
					<expr value=".blog_description h4"/>
				</text>
			</extract-to>
			<extract-to field="blog-author">
				<text>
					<first>
						<expr value="span.author, span.author2"/>
					</first>
				</text>
			</extract-to>
			<extract-to field="blog-keywords">
				<text>
					<expr value=".tagcloud a h3, .tagcloud h3 a"/>
				</text>
			</extract-to>
			<extract-to field="document-type">
				<constant value="First-Page"/>
			</extract-to>
		</document>
		<document url="^http://.+?\.blog.ir/sitemap.xml" engine="xpath">
			<outlinks>
				<link root="dns:url">
					<href>
						<text>
							<expr value="./dns:loc" />
						</text>
					</href>
					<anchor>
						<text>
							<expr value="./blog:dloc" />
						</text>
					</anchor>
				</link>
			</outlinks>			
		</document>
		<document url="^http://.+?\.blog.ir/rss.*" engine="xpath" root="//item" inherits="blog-ir">
			<extract-to field="url">
				<text>
					<expr value="./link" />
				</text>
			</extract-to>
			<extract-to field="post-author">
				<text>
					<expr value="./dc:creator" />
				</text>
			</extract-to>
			<extract-to field="post-keywords">
				<text>
					<expr value="./category" />
				</text>
			</extract-to>
			<extract-to field="post-comments-num">
				<text>
					<expr value="./slash:comments"/>
				</text>
			</extract-to>
		</document>
		<document url="^http://.+?\.blog.ir/category/.*" engine="css" root=".post" inherits="blog-ir">
			<extract-to field="url">
				<resolve>
					<attribute name="href">
						<expr value=".title a" />
					</attribute>
				</resolve>
			</extract-to>
			<extract-to field="post-categories">
				<replace substitution="^http://.+?\.blog.ir/category/(.+?)/?" pattern="$1">
					<url />
				</replace>
			</extract-to>
		</document>
	</documents>
</config>